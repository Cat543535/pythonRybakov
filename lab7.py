# Лабораторная работа №7. Разработка приложения с использованием ООП.
# Вариант 3: Написать класс, который реализует паттерн Singleton.

class Singleton:
    """
    Класс, реализующий паттерн Singleton (Одиночка).
    Гарантирует, что у класса есть только один экземпляр,
    и предоставляет глобальную точку доступа к нему.
    """
    _instance = None  # Приватное поле класса для хранения единственного экземпляра

    def __new__(cls, *args, **kwargs):
        """
        Метод __new__ отвечает за создание экземпляра класса.
        Мы переопределяем его, чтобы контролировать этот процесс.
        """
        if cls._instance is None:
            # Если экземпляра еще нет, создаем его через родительский метод
            cls._instance = super(Singleton, cls).__new__(cls)

            # Флаг для того, чтобы инициализация (__init__) сработала только один раз
            cls._instance._initialized = False

        return cls._instance

    def __init__(self, data=None):
        """
        Инициализация объекта.
        В Python __init__ вызывается каждый раз после __new__.
        Поэтому добавляем проверку, чтобы не перезаписывать данные
        при повторном получении экземпляра.
        """
        if not self._initialized:
            self.data = data
            self._initialized = True

    def get_data(self):
        return self.data

    def set_data(self, new_data):
        self.data = new_data


if __name__ == '__main__':
    print("--- Тестирование паттерна Singleton ---")

    # 1. Создаем первый объект (экземпляр)
    obj1 = Singleton("Первоначальные данные")
    print(f"Объект 1 создан: {obj1}")
    print(f"Данные в объекте 1: {obj1.get_data()}")
    print(f"ID объекта 1 в памяти: {id(obj1)}")

    # 2. Пытаемся создать второй объект
    # Согласно паттерну, новый объект создан не будет, вернется ссылка на первый.
    print("\n--- Попытка создать второй объект ---")
    obj2 = Singleton("Новые данные (игнорируются конструктором)")
    print(f"Объект 2 получен: {obj2}")
    print(f"Данные в объекте 2: {obj2.get_data()}")
    print(f"ID объекта 2 в памяти: {id(obj2)}")

    # 3. Проверка идентичности
    print("\n--- Проверка ---")
    if obj1 is obj2:
        print("УСПЕХ: obj1 и obj2 ссылаются на один и тот же объект в памяти.")
    else:
        print("ОШИБКА: Объекты разные!")

    # 4. Проверка изменения данных
    print("\n--- Изменение данных через obj2 ---")
    obj2.set_data("Данные изменены через obj2")

    print(f"Читаем данные через obj1: '{obj1.get_data()}'")

    if obj1.get_data() == "Данные изменены через obj2":
        print("УСПЕХ: Данные в obj1 изменились, так как это тот же самый объект.")